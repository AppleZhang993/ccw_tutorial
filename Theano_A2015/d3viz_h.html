<!DOCTYPE html>
<html>
<head>
	<link rel="stylesheet" href="d3viz/css/d3viz.css"/>
	<link rel="stylesheet" href="d3viz/css/d3-context-menu.css"/>
	<script type="text/javascript" src="d3viz/js/d3viz.js"></script>
	<script type="text/javascript" src="d3viz/js/d3.v3.min.js"></script>
	<script type="text/javascript" src="d3viz/js/dagre-d3.min.js"></script>
	<script type="text/javascript" src="d3viz/js/graphlib-dot.min.js"></script>
	<script type="text/javascript" src="d3viz/js/d3-context-menu.js"></script>
</head>
<body>
	<div id='menu' class='menuBar'>
	    <input name="resetNodes" 
	           type="button" 
	           value="Reset nodes"
	           onclick="resetNodes()"/>
	    <input name="releaseNodes" 
	           type="button" 
	           value="Release nodes"
	           onclick="releaseNodes()"/>
	</div>

	<script type="text/javascript">
		// Backend graph in DOT format
		var dotGraph = graphlibDot.read("digraph G {	graph [bb=\"0,0,488,471\"];	node [label=\"\N\"];	n1	 [apply_op=DimShuffle,		height=0.5,		label=DimShuffle,		node_type=apply,		pos=\"90,366\",		shape=ellipse,		width=1.4624];	n3	 [height=0.5,		pos=\"27,279\",		width=0.75];	n1 -> n3	 [label=dmatrix,		lp=\"54.5,322.5\",		pos=\"e,25.478,296.99 57.486,351.73 48.138,346.35 38.888,339.19 33,330 28.671,323.24 26.675,314.9 25.896,306.99\"];	n8	 [apply_op=CGemv,		height=0.5,		label=CGemv,		node_type=apply,		pos=\"310,192\",		shape=ellipse,		width=1.0652];	n1 -> n8	 [label=\"2 dscalar\",		lp=\"123.5,279\",		pos=\"e,276.98,201.49 86.198,347.8 82.289,325.3 79.239,285.81 99,261 109.74,247.52 208.77,219.61 267.26,204.06\"];	n2	 [dtype=dmatrix,		fillcolor=limegreen,		height=0.5,		label=W,		node_type=input,		pos=\"152,453\",		shape=box,		style=filled,		width=0.75];	n2 -> n1	 [color=dodgerblue,		label=dmatrix,		lp=\"146.5,409.5\",		pos=\"e,102.11,383.6 139.45,434.8 130.43,422.43 118.12,405.55 108.04,391.74\"];	n4	 [apply_op=Shape_i,		fillcolor=cyan,		height=0.5,		label=Shape_i,		node_type=apply,		pos=\"203,366\",		shape=ellipse,		style=filled,		type=colored,		width=1.0832];	n2 -> n4	 [label=dmatrix,		lp=\"202.5,409.5\",		pos=\"e,193.04,383.6 162.32,434.8 169.6,422.66 179.49,406.19 187.69,392.52\"];	n6	 [apply_op=AllocEmpty,		fillcolor=\"#FFAA22\",		height=0.5,		label=AllocEmpty,		node_type=apply,		pos=\"211,279\",		shape=ellipse,		style=filled,		type=colored,		width=1.4985];	n4 -> n6	 [label=dmatrix,		lp=\"229.5,322.5\",		pos=\"e,209.38,297.18 204.62,347.8 205.71,336.16 207.18,320.55 208.44,307.24\"];	n6 -> n8	 [color=red,		label=\"0 dmatrix\",		lp=\"279,235.5\",		pos=\"e,284.76,205.74 222.65,261 230.25,250.69 240.8,237.7 252,228 259.25,221.73 267.76,215.9 276,210.87\"];	n12	 [dtype=dvector,		fillcolor=dodgerblue,		height=0.5,		label=dvector,		node_type=output,		pos=\"344,105\",		shape=box,		style=filled,		width=0.79167];	n8 -> n12	 [label=dvector,		lp=\"350.5,148.5\",		pos=\"e,337.18,123.05 316.72,174.21 321.48,162.29 327.97,146.06 333.43,132.42\"];	n13	 [apply_op=Elemwise,		fillcolor=\"#FFAABB\",		height=0.5,		label=Elemwise,		node_type=apply,		pos=\"223,105\",		shape=ellipse,		style=filled,		type=colored,		width=1.2818];	n8 -> n13	 [label=\"0 dvector\",		lp=\"295,148.5\",		pos=\"e,237.03,122.22 291.62,176.12 284.4,170.07 276.14,162.88 269,156 260.42,147.73 251.44,138.2 243.72,129.69\"];	n9	 [dtype=dscalar,		fillcolor=SpringGreen,		height=0.5,		label=\" 1.\",		node_type=constant_input,		pos=\"310,279\",		shape=box,		style=filled,		width=0.75];	n9 -> n8	 [label=\"1 dscalar\",		lp=\"334.5,235.5\",		pos=\"e,310,210.18 310,260.8 310,249.16 310,233.55 310,220.24\"];	n10	 [dtype=dvector,		fillcolor=limegreen,		height=0.5,		label=x,		node_type=input,		pos=\"382,279\",		shape=box,		style=filled,		width=0.75];	n10 -> n8	 [label=\"3 dvector\",		lp=\"395,235.5\",		pos=\"e,334.04,206.03 377.11,260.98 373.54,250.67 367.94,237.68 360,228 355.1,222.03 348.94,216.62 342.63,211.94\"];	n11	 [dtype=dscalar,		fillcolor=SpringGreen,		height=0.5,		label=\" 0.\",		node_type=constant_input,		pos=\"457,279\",		shape=box,		style=filled,		width=0.75];	n11 -> n8	 [label=\"4 dscalar\",		lp=\"463.5,235.5\",		pos=\"e,346.67,197.46 449.86,260.92 444.5,250.05 436.17,236.47 425,228 405.24,213.03 379.05,204.41 356.66,199.48\"];	n15	 [dtype=dvector,		fillcolor=dodgerblue,		height=0.5,		label=dvector,		node_type=output,		pos=\"223,18\",		shape=box,		style=filled,		width=0.79167];	n13 -> n15	 [label=dvector,		lp=\"243.5,61.5\",		pos=\"e,223,36.175 223,86.799 223,75.163 223,59.548 223,46.237\"];	n14	 [dtype=dvector,		fillcolor=limegreen,		height=0.5,		label=b,		node_type=input,		pos=\"194,192\",		shape=box,		style=filled,		width=0.75];	n14 -> n13	 [label=\"1 dvector\",		lp=\"221,148.5\",		pos=\"e,206.54,122.05 191.66,173.84 190.97,163.95 191.22,151.45 195,141 196.36,137.24 198.31,133.58 200.54,130.13\"];}");
		// Frontend graph for visualization
		var graph = {};
		
		var forceLayout;
		var isProfiled = false; // true if profiling information available
		var useProfileColors = false;
		var fixOnInit = true; // fix nodes on initialization
		var maxProfilePer = 0;
		var profileColors = ["#fff5f0","#fee0d2","#fcbba1","#fc9272","#fb6a4a","#ef3b2c","#cb181d","#a50f15"];
		var pad = 10;
		var isEditNode = false; // true if node is edited
		var menuItems = [
			{
				title: 'Edit',
				action: function(elm, d, i) { editNode(elm, d); }
			},
			{
				title: 'Release',
				action: function(elm, d, i) { releaseNode(d); }
			}
		];

		// Create main panel
		d3.select('body').select('svg').remove();
		var svg = d3.select('body').append('svg')
			.attr('width', '100%')
			.attr('height', '95%');
		var pane = svg.append('g');
		
		// Zoom behaviour
		var zoom = d3.behavior.zoom()
			.scaleExtent([0.2, 8])
			.on('zoom', function(d) {
				var trans = d3.event.translate;
				trans[0] += 300;
				trans[1] += 100;
				pane.attr('transform', 'translate(' + trans + ') scale(' + d3.event.scale + ')');
			});
		svg.call(zoom);
		zoom.event(svg);
		svg.on("dblclick.zoom", null);
		
		// Edges
		var edgeDiv = d3.select('body').append('div')
			.attr('class', 'edgeTooltip')
			.style('opacity', 0.0);
		
		// Div for node details	
		var nodeInfo = d3.select('body').append('div')
			.attr('class', 'nodeInfo')
			.style('opacity', 0.0);
		
		// Definition head of edges
		var markerData = [
			{'id': 'n', 'color': 'black'},
			{'id': 'r', 'color': 'red'},
			{'id': 'b', 'color': 'dodgerblue'}];
		svg.append("defs").selectAll('marker').data(markerData).enter().append("marker")
		    .attr("id", function(d) { return 'edgeArrow_' + d.id;})
		    .attr("markerWidth", 4)
		    .attr("markerHeight", 4)
		    .attr("refX", 2)
		    .attr("refY", 2)
		    .attr("orient", "auto")
		  	.append("path")
		    .attr("d", "M0,0 L4,2 L0,4 Z")
		    .attr('fill', function(d) { return d.color;});
	
		// Initialize graph
		processDotGraph(dotGraph);		
		graph = frontEndGraph(dotGraph);
		drawGraph();
	</script>
</body>
</html>
